{% extends 'base.html' %}
{% load humanize %}
{% load static %}

{% block content %}
 <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <!--<div class="col-sm-6"><h3 class="mb-0">Dashboard</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                </ol>
              </div>-->
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <!--begin::Col-->
              <div class="col-lg-1 col-6">
                  </div>

              <div class="col-lg-3 col-6">
              
              
              </div>
          
              
              <!--end::Col-->
              <div class="col-lg-4 col-6">
                <!--begin::Small Box Widget 2-->
                <div class="small-box text-bg-success">
                  <div class="inner">
                    <h3>{{total.total_quantite  | intcomma }} <sup class="fs-5"></sup></h3>
                    <h4> Quantite Total  </h4>
                  </div>
                  <svg
                    class="small-box-icon"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
                    ></path>
                  </svg>
                  <a
                    href="#"
                    class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                  >
                    More info <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 2-->
              </div>
             
            </div>
            <!--end::Row-->

            
            <div class="row">
                   
<div class="col-md-12">
  <h4 class="mb-3 text-center fw-bold text-success" style="font-family: Georgia, serif; font-size: 1.5rem;">
    Enregistrement des Lots de Pondeuses
  </h4>
<div class="container">
     <div class="card card-success card-outline mb-4">
       <div class="card-body">
         <br>

            <!-- Messages -->
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}
            {% endif %}

      <!-- Formulaire -->
      
        
    <div class="col-md-12">
     <div class="border p-3 rounded">  
         

      {% if names %}
      
       <form method="post" novalidate>
          {% csrf_token %}
        <div class="container">

            
            
              <div class="row mb-3">
        
              <div class="col">
                <input type="text" name="fournisseur"   value="{{names.fournisseur}}" class="form-control" placeholder="Fournisseur">
              </div>

              <div class="col">
                <input type="number" name="nombre_initial" value="{{names.nombre_initial}}" class="form-control" placeholder="Nombre">
              </div>
            </div>

            <div class="row mb-3">
              
              <div class="col">
                <input type="number" name="prix_unitaire" step="0.01" class="form-control"  value="{{names.prix_unitaire }}" placeholder="Prix">
              </div>
           
              <div class="col">
                <input type="date" name="datetime" step="0.01" class="form-control"  value="{{names.date_arrivee }}" placeholder="Date">
              </div>
           
           
            </div>

           

            <div class="d-grid gap-2">
              <button  name="modif" value="{{names.id}}" class="btn btn-success" type="submit">
                Enregistrer
              </button>
            </div>


            {% else %}
      
             <form method="post" novalidate>
          {% csrf_token %}
        <div class="container">

            
            
            <div class="row mb-3">
              
              <div class="col">
                <input type="text" name="fournisseur"   class="form-control" placeholder="Fournisseur">
              </div>
              
              <div class="col">
                <input type="number" name="nombre_initial" class="form-control" placeholder="Nombre">
              </div>

            </div>

            <div class="row mb-3">
              
                <div class="col">
                  <input type="number" name="prix_unitaire" step="0.01" class="form-control"  placeholder="Prix">
                </div>
              
              <div class="col">
                  <input type="date" name="datetime" step="0.01" class="form-control"  value="{{names.date_arrivee }}" placeholder="Date">
                </div>
           
            </div>
           

            <div class="d-grid gap-2">
              <button class="btn btn-success" type="submit">
                Enregistrer
              </button>
            </div>

      
      {% endif %}

     
            </form>

          









          </div>
          </div>
        <br>
  

       
  
  <!-- Tableau des lots -->
  <div class="card card-secondary card-outline">
    <div class="card-header">
      <h5 class="card-title">Liste des lots enregistrés</h5>
    </div>
    <div class="card-body p-0">
      <table class="table table-striped table-bordered mb-0">
        <thead class="table-dark">
          <tr>
          
            <th>Nom du lot</th>
           
            <th>Fournisseur</th>
            <th>Lot de Poulet</th>
            <th>Prix unitaire (francs)</th>
            <th>Date arrivée</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for lot in lots %}
            <tr>
              
              <td>{{ lot.nom_lot }}</td>
            
              <td>{{ lot.fournisseur }}</td>
              <td>{{ lot.nombre_initial  | intcomma }}</td>
              <td>{{ lot.prix_unitaire  | intcomma }} </td>
              <td>{{ lot.date_arrivee }}</td>
              <td class="text-center">
                <a href="{% url 'supprimer_lot' lot.id %}" class="btn btn-danger btn-sm" title="Supprimer"
                  onclick="return confirm('⚠️ Êtes-vous sûr de vouloir supprimer ce lot ?');">
                  <i class="bi bi-trash"></i>                
                </a>
                 <a href="{% url 'loteDePoulets' %}?name={{lot.id}}" class="btn btn-info btn-sm" title="modifier">
                  <i class="bi bi-pencil"></i>                
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" class="text-center">Aucun lot enregistré.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  </div>
  </div>
</div>
 </div>
 </div>
            </div>
            <!-- /.row (main row) -->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->
      </main>
 
<!-- Auto-fermeture des messages -->
<script>
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => {
      let bsAlert = bootstrap.Alert.getOrCreateInstance(alert)
      bsAlert.close()
    })
  }, 5000);
</script>
{% endblock %}
