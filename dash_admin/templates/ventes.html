{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}

 <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <!--<div class="col-sm-6"><h3 class="mb-0">Dashboard</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                </ol>
              </div>-->
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
          <!--begin::Container-->
        <div class="container-fluid">
            <!--begin::Row-->
           <div class="row"   style="position:relative; left:0px;">
               
              <!--end::Col-->
              <!--begin::Col-->
              <div class="col-lg-4 col-6">
                <!--begin::Small Box Widget 1-->

                <div class="small-box text-bg-info">
                  <div class="inner">
                    <h3>{{ total_prod | intcomma }} </h3>
                    <h4>Oeuf disponibles</h4>
                  </div
                    class="small-box-icon"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
                    ></path>
                  </svg>
                  <a
                    href="#"
                    class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                  >
                     <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 1-->
             
                <!--end::Small Box Widget 1-->
              </div>
              
              <div class="col-lg-4 col-6">
             
                <div class="small-box text-bg-primary">
                  <div class="inner">
                    <h3>{{ total_pond  | intcomma }} </h3>
                    <h4> Pondeuse disponibles</h4>
                  </div>
                  <svg
                    class="small-box-icon"
                    fill="currentColor"
                    viewBox="0 0 24 24"primary
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
                    ></path>
                  </svg>
                  <a
                    href="#"
                    class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                  >
                     <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
              </div>

            
              <div class="col-lg-4 col-6">
                <!--begin::Small Box Widget 1-->

                <div class="small-box text-bg-warning">
                  <div class="inner">
                    <h3>{{ total_quant  | intcomma }} </h3>
                    <h4>Quantité Total</h4>
                  </div>
                  <svg
                    class="small-box-icon"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
                    ></path>
                  </svg>
                  <a
                    href="#"
                    class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                  >
                     <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 1-->
              </div>
             
            
             
             
            </div>
            <!--end::Row-->

            
            <div class="row">
             <div class="col-md-12">
             
<div class="col-md-12">
<h4 class="mb-3 text-center fw-bold text-warning" style="font-family: Georgia, serif; font-size: 1.5rem;">
  Enregistrement des ventes
</h4>

<div class="container">
<div class="card card-warning card-outline mb-4">
  <div class="card-body">
    <br>


{% if nom  %}  



      {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}

    

    <div class="col-md-12">
      <div class="border p-3 rounded">
        <form method="post" action="{% url 'ventes' %}">
          {% csrf_token %}
          <div class="row mb-3">
            <div class="col">
              <label for="ferme">Lot de Pondeuses</label>
               <select name="lot" id="lot" class="form-control" required>
                  <option value="">-- Sélectionner un lot --</option>
                  {% for lot in lots %}
                     <a href="{% url "ventes" %}"> 
                    <option value="{{ lot.id }}" {% if lot.id == nom.lot.id %}selected{% endif %} >
                    {{ lot.nom_lot }} 
                    </option>
                    </a>
                  {% endfor %}
                </select>
            </div>
            <div class="col">
              <label for="type_produit">Type </label>
              <select name="type_produit" id="type_produit" class="form-control" required>
                <option value="">-- Choisir --</option>
            
                {% for label in type_production_choices %}
                  <option value="{{ label }}">{{ label|title }}</option>
                {% endfor %}             
              </select>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label for="quantite">Quantité</label>
              <input type="number" step="1" name="quantite_vendue" value="{{ nom.quantite_vendue|default:'' }}" class="form-control" required>
            </div>
            <div class="col">
              <label for="prix_unitaire">Prix Unitaire (FCFA)</label>
              <input type="number" step="0.01" name="prix_unitaire" value="{{ nom.prix_unitaire|default:'' }}" class="form-control" required>
            </div>
             <div class="col">
              <label for="date">Prix Unitaire (FCFA)</label>
              <input type="date" step="0.01" name="date" value="{{ nom.date|default:'' }}" class="form-control" required>
            </div>
         
          </div>

          <div class="d-grid gap-2">
            <button type="submit" name="modifier" value="{{nom.id}}" class="btn btn-warning">Ajouter</button>
          </div>
        </form>
      <br>


{% else %}



      {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}

    

    <div class="col-md-12">
      <div class="border p-3 rounded">
        <form method="post" action="{% url 'ventes' %}">
          {% csrf_token %}
          <div class="row mb-3">
            <div class="col">
              <label for="ferme">Lot de Pondeuses</label>
               <select name="lot" id="lot" class="form-control" required>
                  <option value="">-- Sélectionner un lot --</option>
                  {% for lot in lots %}
                     <a href="{% url "ventes" %}"> 
                    <option value="{{ lot.id }}" {% if production and lot.id == ventes.lot.id %}selected{% endif %}>
                    {{ lot.nom_lot }} 
                    </option>
                    </a>
                  {% endfor %}
                </select>
            </div>
            <div class="col">
              <label for="type_produit">Type </label>
              <select name="type_produit" id="type_produit" class="form-control" required>
                <option value="">-- Choisir --</option>
            
                {% for label in type_production_choices %}
                  <option value="{{ label }}">{{ label|title }}</option>
                {% endfor %}             
              </select>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label for="quantite">Quantité</label>
              <input type="number" step="1" name="quantite_vendue" value="{{ vente.quantite_vendue|default:'' }}" class="form-control" required>
            </div>
            <div class="col">
              <label for="prix_unitaire">Prix Unitaire (FCFA)</label>
              <input type="number" step="0.01" name="prix_unitaire" value="{{ vente.prix_unitaire|default:'' }}" class="form-control" required>
            </div>
             <div class="col">
              <label for="date">Date</label>
              <input type="date" step="0.01" name="date" value="{{ vente.date|default:'' }}" class="form-control" required>
            </div>
         
          </div>

          <div class="d-grid gap-2">
            <button type="submit" name="Ajout" value="1" class="btn btn-warning">Ajouter</button>
          </div>
        </form>
      <br>




{% endif %}


<!-- Tableau des ventes -->
<table class="table table-striped table-bordered">
  <thead class="table-dark">
    <tr>
      <th>Lot de Pondeuses</th>
      <th>Type</th>
      <th>Quantité</th>
      <th>Prix Unitaire</th>
      <th>Montant Total</th>
      <th>Date</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for vente in ventes %}
      <tr>
        <td>{{ vente.lot }}</td>
        <td>{{ vente.type_produit }}</td>
        <td>{{ vente.quantite_vendue | intcomma }}</td>
        <td>{{ vente.prix_unitaire | intcomma  }}</td>
        <td>{{ vente.montant_total | intcomma  }}</td>
        <td>{{ vente.date_vente }}</td>
        <td>
          <a href="{% url 'supprimer_vente' vente.id %}" onclick="return confirm('Tu es sûr de vouloir supprimer cette vente ?');" class="btn btn-danger btn-sm">
            Supprimer
          </a>
          <a href="{% url 'ventes' %}?modifier={{vente.id}}" class="btn btn-info btn-sm">
            Modifier
          </a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="7" class="text-center">Aucune vente enregistrée.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
</div>
    </div>
  </div>
</div>
</div>
</div>

            </div>
            <!-- /.row (main row) -->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->
      </main>


<script>
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => {
      let bsAlert = bootstrap.Alert.getOrCreateInstance(alert)
      bsAlert.close()
    })
  }, 5000);
</script>
{% endblock %}
