{% extends 'base.html' %}
{% load humanize %}
 {% load static %}

{% block content %}
<!-- Bouton pour afficher le formulaire -->
  <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <!--<div class="col-sm-6"><h3 class="mb-0">Dashboard</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                </ol>
              </div>-->
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <!--begin::Col-->
        
              <!--end::Col-->
              <div class="col-lg-4 col-6">
              
              </div>
              <!--end::Col-->
              <div class="col-lg-4 col-6">
                <!--begin::Small Box Widget 3-->
                <div class="small-box text-bg-primary">
                  <div class="inner">
                    <h3>{{ quantite_kg | intcomma }} kg</h3>
                    <h4>üìà Quantit√© en Kg</h4>
                  </div>
                  <svg
                    class="small-box-icon"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      d="M6.25 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM3.25 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM19.75 7.5a.75.75 0 00-1.5 0v2.25H16a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H22a.75.75 0 000-1.5h-2.25V7.5z"
                    ></path>
                  </svg>
                  <a
                    href="#"
                    class="small-box-footer link-dark link-underline-opacity-0 link-underline-opacity-50-hover"
                  >
                    More info <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 3-->
              </div>
              <!--end::Col-->
            
            </div>
            <!--end::Row-->

            
            <div class="row">
              <div class="col-md-12">
   <h4 class="mb-3 text-center fw-bold text-primary" style="font-family: Georgia, serif; font-size: 1.5rem;">
    Enregistrement des aliments des Pondeuses
  </h4>
  <div class="container">
  <div class="card card-primary card-outline mb-4">



    <div class="card-body">
      <br>


{% if nom == 2 %} 


      <!-- Messages -->
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}



    <div class="col-md-12">
    <div class="border p-3 rounded">  <!-- Bordure + padding + coins arrondis -->
      <form method="post" action="{% url 'alimentations' %}">
        {% csrf_token %}
        <div class="row mb-3">
          <div class="col">
            <label for="lot">Lot</label>
            <select name="lot" id="lot" class="form-control" required>
              <option value="">-- S√©lectionner un lot --</option>
             {% for lot in lots %}
                <option value="{{ lot.id }}" {% if alimentation and lot.id == alimentation.lot.id %}selected{% endif %}>
                  {{ lot.nom_lot }}
                </option>
              {% endfor %}
            </select>
          </div>

    <div class="col d-flex align-items-end">
      <div class="w-100">
        <label for="type_aliment">Type d'aliment</label>
        <div class="input-group">
          <select name="type_aliment" id="type_aliment" class="form-control" required>
            <option value="">-- S√©lectionner un type d'aliment --</option>
            {% for val, label in types_aliments %}
              <option value="{{ val }}" {% if alimentation and val == alimentation.type_aliment %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>
          
        </div>
      </div>
    </div>
  </div>


      <div class="row mb-3">
        <div class="col">
          <label for="quantite_kg">Quantit√© (kg)</label>
          <input type="number" name="quantite_kg" step="0.01" 
                 value="{{ alimentation.quantite_kg }}" placeholder="{{ alimentation.quantite_kg }}" class="form-control" required>
        </div>
        
        <div class="col">
          <label for="quantite_kg">Dates</label>
          <input type="date" name="datetime" 
                 value="{{alimentation.date}}"   placeholder="{{ alimentation.date  }}" class="form-control" required>
        </div>
        </div>
      </div>
      <div class="d-grid gap-2">
        <button type="submit" name="modifi"   value="{{ alimentation.pk }}"  class="btn btn-primary">Ajouter</button>
      </div>
    </form>

<br>


{% else %}

      <!-- Messages -->
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}



    <div class="col-md-12">
    <div class="border p-3 rounded">  <!-- Bordure + padding + coins arrondis -->
      <form method="post" action="{% url 'alimentations' %}">
        {% csrf_token %}
        <div class="row mb-3">
          <div class="col">
            <label for="lot">Lot</label>
            <select name="lot" id="lot" class="form-control" required>
              <option value="">-- S√©lectionner un lot --</option>
              {% for lot in lots %}
                <option value="{{ lot.id }}" {% if alimentation and lot.id == alimentation.lot.id %}selected{% endif %}>
                  {{ lot.nom_lot }}
                </option>
              {% endfor %}
            </select>
          </div>

    <div class="col d-flex align-items-end">
      <div class="w-100">
        <label for="type_aliment">Type d'aliment</label>
        <div class="input-group">
          <select name="type_aliment" id="type_aliment" class="form-control" required>
            <option value="">-- S√©lectionner un type d'aliment --</option>
            {% for val, label in types_aliments %}
              <option value="{{ val }}" {% if alimentation and val == alimentation.type_aliment %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>
          
        </div>
      </div>
    </div>
  </div>


      <div class="row mb-3">
        <div class="col">
          <label for="quantite_kg">Quantit√© (kg)</label>
          <input type="number" name="quantite_kg" step="0.01" 
                 value="{{ alimentation.quantite_kg|default_if_none:'' }}" class="form-control" required>
        </div>
        <div class="col">
          <label for="quantite_kg">Dates</label>
          <input type="date" name="datetime" 
                 value="" class="form-control" required>
        </div>
        </div>
      </div>
      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary">Ajouter</button>
      </div>
    </form>

<br>




{% endif %}


  <!-- Tableau des alimentations -->
   <div class="card card-secondary card-outline">
    <div class="card-header">
      <h5 class="card-title">Liste des lots enregistr√©s</h5>
    </div>
    <div class="card-body p-0">
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Lot</th>
   
        <th>Type d'aliment</th>
        <th>Quantit√© (kg)</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for alimentation in alimentations %}
        <tr>
          <td>{{ alimentation.lot.nom_lot }}</td>
          
          <td>{{ alimentation.type_aliment }}</td>
          <td>{{ alimentation.quantite_kg }}</td>
          <td>{{ alimentation.date }}</td>
          <td>
           
            <a href="{% url 'supprimer_alimentation' alimentation.id %}" class="btn btn-danger btn-sm" title="Supprimer"
               onclick="return confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir supprimer cette alimentation ?');">
              <i class="bi bi-trash"></i>            
            </a>
          
            <a href="{% url 'alimentations'%}?modifier={{ alimentation.id }}"  class="btn btn-info btn-sm" title="Modifier"
               >
              <i class="bi bi-pencil"></i>            
            </a>
      
         
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5" class="text-center">Aucune alimentation enregistr√©e.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</div>
</div>
</div>
  </div>
</div>
</div>
</div>
            </div>
            <!-- /.row (main row) -->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->
      </main>

<!-- Auto-close des messages -->
<script>
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => {
      let bsAlert = bootstrap.Alert.getOrCreateInstance(alert)
      bsAlert.close()
    })
  }, 5000); 
</script>

{% endblock %}
